function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function n(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}var a="2.2.0",s="MG",r={},o=Array.prototype,c=Object.prototype,u=o.slice,h=c.toString,l=Object.prototype.hasOwnProperty,d=o.forEach,p=Array.isArray,f={},g=["utm_source","utm_medium","utm_campaign","utm_content","utm_term"];r.each=function(e,t,i){if(null==e)return!1;if(d&&e.forEach===d)e.forEach(t,i);else if(e.length===+e.length){for(var n=0,a=e.length;n<a;n++)if(n in e&&t.call(i,e[n],n,e)===f)return!1}else for(var s in e)if(l.call(e,s)&&t.call(i,e[s],s,e)===f)return!1},r.extend=function(e){return r.each(u.call(arguments,1),(function(t){for(var i in t)void 0!==t[i]&&(e[i]=t[i])})),e},r.extend2Layers=function(e){return r.each(u.call(arguments,1),(function(t){for(var i in t)void 0!==t[i]&&(r.isObject(t[i])&&r.isObject(e[i])?r.extend(e[i],t[i]):e[i]=t[i])})),e},r.isArray=p||function(e){return"[object Array]"===h.call(e)},r.isFunction=function(e){try{return"function"==typeof e}catch(e){return!1}},r.isPromise=function(e){return"[object Promise]"===h.call(e)&&null!=e},r.isObject=function(e){return"[object Object]"===h.call(e)&&null!=e},r.isEmptyObject=function(e){if(r.isObject(e)){for(var t in e)if(l.call(e,t))return!1;return!0}return!1},r.isUndefined=function(e){return void 0===e},r.isString=function(e){return"[object String]"===h.call(e)},r.isDate=function(e){return"[object Date]"===h.call(e)},r.isBoolean=function(e){return"[object Boolean]"===h.call(e)},r.isNumber=function(e){return"[object Number]"===h.call(e)&&/[\d\.]+/.test(String(e))},r.isJSONString=function(e){try{JSON.parse(e)}catch(e){return!1}return!0},r.decodeURIComponent=function(e){var t="";try{t=decodeURIComponent(e)}catch(i){t=e}return t},r.encodeURIComponent=function(e){var t="";try{t=encodeURIComponent(e)}catch(i){t=e}return t},r.utf8Encode=function(e){var t,i,n,a,s="";for(t=i=0,n=(e=(e+"").replace(/\r\n/g,"\n").replace(/\r/g,"\n")).length,a=0;a<n;a++){var r=e.charCodeAt(a),o=null;r<128?i++:o=r>127&&r<2048?String.fromCharCode(r>>6|192,63&r|128):String.fromCharCode(r>>12|224,r>>6&63|128,63&r|128),null!==o&&(i>t&&(s+=e.substring(t,i)),s+=o,t=i=a+1)}return i>t&&(s+=e.substring(t,e.length)),s},r.base64Encode=function(e){var t,i,n,a,s,o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",c=0,u=0,h="",l=[];if(!e)return e;e=r.utf8Encode(e);do{t=(s=e.charCodeAt(c++)<<16|e.charCodeAt(c++)<<8|e.charCodeAt(c++))>>18&63,i=s>>12&63,n=s>>6&63,a=63&s,l[u++]=o.charAt(t)+o.charAt(i)+o.charAt(n)+o.charAt(a)}while(c<e.length);switch(h=l.join(""),e.length%3){case 1:h=h.slice(0,-2)+"==";break;case 2:h=h.slice(0,-1)+"="}return h},r.encodeDates=function(e){return r.each(e,(function(t,i){if(r.isDate(t))e[i]=r.formatDate(t);else if(r.isObject(t))e[i]=r.encodeDates(t);else if(r.isArray(t))for(var n=0;n<t.length;n++)r.isDate(t[n])&&(e[i][n]=r.formatDate(t[n]))})),e},r.formatDate=function(e){function t(e){return e<10?"0"+e:e}return e.getFullYear()+"-"+t(e.getMonth()+1)+"-"+t(e.getDate())+" "+t(e.getHours())+":"+t(e.getMinutes())+":"+t(e.getSeconds())+"."+((i=e.getMilliseconds())<100&&i>9?"0"+i:i<10?"00"+i:i);var i},r.searchObjDate=function(e){try{(r.isObject(e)||r.isArray(e))&&r.each(e,(function(t,i){r.isObject(t)||r.isArray(t)?r.searchObjDate(e[i]):r.isDate(t)&&(e[i]=r.formatDate(t))}))}catch(e){v.warn(e)}},r.UUID=function(){var e=(new Date).getTime();return String(Math.random()).replace(".","").slice(1,11)+"-"+e},r.UUIDv4=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))},r.setMpPlatform=function(e){r.mpPlatform=e},r.getMpPlatform=function(){return r.mpPlatform},r.createExtraHeaders=function(){return{"TA-Integration-Type":s,"TA-Integration-Version":a,"TA-Integration-Count":"1","TA-Integration-Extra":r.getMpPlatform()}},r.checkAppId=function(e){return e=e.replace(/\s*/g,"")},r.checkUrl=function(e){return e=e.replace(/\s*/g,""),e=r.url("basic",e)},r.url=function(){function e(){return new RegExp(/(.*?)\.?([^.]*?)\.(com|net|org|biz|ws|in|me|co\.uk|co|org\.uk|ltd\.uk|plc\.uk|me\.uk|edu|mil|br\.com|cn\.com|eu\.com|hu\.com|no\.com|qc\.com|sa\.com|se\.com|se\.net|us\.com|uy\.com|ac|co\.ac|gv\.ac|or\.ac|ac\.ac|af|am|as|at|ac\.at|co\.at|gv\.at|or\.at|asn\.au|com\.au|edu\.au|org\.au|net\.au|id\.au|be|ac\.be|adm\.br|adv\.br|am\.br|arq\.br|art\.br|bio\.br|cng\.br|cnt\.br|com\.br|ecn\.br|eng\.br|esp\.br|etc\.br|eti\.br|fm\.br|fot\.br|fst\.br|g12\.br|gov\.br|ind\.br|inf\.br|jor\.br|lel\.br|med\.br|mil\.br|net\.br|nom\.br|ntr\.br|odo\.br|org\.br|ppg\.br|pro\.br|psc\.br|psi\.br|rec\.br|slg\.br|tmp\.br|tur\.br|tv\.br|vet\.br|zlg\.br|br|ab\.ca|bc\.ca|mb\.ca|nb\.ca|nf\.ca|ns\.ca|nt\.ca|on\.ca|pe\.ca|qc\.ca|sk\.ca|yk\.ca|ca|cc|ac\.cn|net\.cn|com\.cn|edu\.cn|gov\.cn|org\.cn|bj\.cn|sh\.cn|tj\.cn|cq\.cn|he\.cn|nm\.cn|ln\.cn|jl\.cn|hl\.cn|js\.cn|zj\.cn|ah\.cn|gd\.cn|gx\.cn|hi\.cn|sc\.cn|gz\.cn|yn\.cn|xz\.cn|sn\.cn|gs\.cn|qh\.cn|nx\.cn|xj\.cn|tw\.cn|hk\.cn|mo\.cn|cn|cx|cz|de|dk|fo|com\.ec|tm\.fr|com\.fr|asso\.fr|presse\.fr|fr|gf|gs|co\.il|net\.il|ac\.il|k12\.il|gov\.il|muni\.il|ac\.in|co\.in|org\.in|ernet\.in|gov\.in|net\.in|res\.in|is|it|ac\.jp|co\.jp|go\.jp|or\.jp|ne\.jp|ac\.kr|co\.kr|go\.kr|ne\.kr|nm\.kr|or\.kr|li|lt|lu|asso\.mc|tm\.mc|com\.mm|org\.mm|net\.mm|edu\.mm|gov\.mm|ms|nl|no|nu|pl|ro|org\.ro|store\.ro|tm\.ro|firm\.ro|www\.ro|arts\.ro|rec\.ro|info\.ro|nom\.ro|nt\.ro|se|si|com\.sg|org\.sg|net\.sg|gov\.sg|sk|st|tf|ac\.th|co\.th|go\.th|mi\.th|net\.th|or\.th|tm|to|com\.tr|edu\.tr|gov\.tr|k12\.tr|net\.tr|org\.tr|com\.tw|org\.tw|net\.tw|ac\.uk|uk\.com|uk\.net|gb\.com|gb\.net|vg|sh|kz|ch|info|ua|gov|name|pro|ie|hk|com\.hk|org\.hk|net\.hk|edu\.hk|us|tk|cd|by|ad|lv|eu\.lv|bz|es|jp|cl|ag|mobi|eu|co\.nz|org\.nz|net\.nz|maori\.nz|iwi\.nz|io|la|md|sc|sg|vc|tw|travel|my|se|tv|pt|com\.pt|edu\.pt|asia|fi|com\.ve|net\.ve|fi|org\.ve|web\.ve|info\.ve|co\.ve|tel|im|gr|ru|net\.ru|org\.ru|hr|com\.hr|ly|xyz)$/)}function t(e,t){var i=e.charAt(0),n=t.split(i);return i===e?n:n[(e=parseInt(e.substring(1),10))<0?n.length+e:e-1]}function i(e,t){for(var i,n=e.charAt(0),a=t.split("&"),s=[],o={},c=[],u=e.substring(1),h=0,l=a.length;h<l;h++)if((s=a[h].match(/(.*?)=(.*)/))||(s=[a[h],a[h],""]),""!==s[1].replace(/\s/g,"")){if(s[2]=(i=s[2]||"",r.decodeURIComponent(i.replace(/\+/g," "))),u===s[1])return s[2];(c=s[1].match(/(.*)\[([0-9]+)\]/))?(o[c[1]]=o[c[1]]||[],o[c[1]][c[2]]=s[2]):o[s[1]]=s[2]}return n===e?o:o[u]}return function(n,a){var s,r={};if("tld?"===n)return e();if(a=a||window.location.toString(),!n)return a;if(n=n.toString(),a.match(/^mailto:([^/].+)/))s=a.match(/^mailto:([^/].+)/),r.protocol="mailto",r.email=s[1];else{if(a.match(/(.*?)\/#!(.*)/)&&(s=a.match(/(.*?)\/#!(.*)/),a=s[1]+s[2]),a.match(/(.*?)#(.*)/)&&(s=a.match(/(.*?)#(.*)/),r.hash=s[2],a=s[1]),r.hash&&n.match(/^#/))return i(n,r.hash);if(a.match(/(.*?)\?(.*)/)&&(s=a.match(/(.*?)\?(.*)/),r.query=s[2],a=s[1]),r.query&&n.match(/^\?/))return i(n,r.query);if(a.match(/(.*?):?\/\/(.*)/)&&(s=a.match(/(.*?):?\/\/(.*)/),r.protocol=s[1].toLowerCase(),a=s[2]),a.match(/(.*?)(\/.*)/)&&(s=a.match(/(.*?)(\/.*)/),r.path=s[2],a=s[1]),r.path=(r.path||"").replace(/^([^/])/,"/$1").replace(/\/$/,""),n.match(/^[-0-9]+$/)&&(n=n.replace(/^([^/])/,"/$1")),n.match(/^\//))return t(n,r.path.substring(1));if((s=t("/-1",r.path.substring(1)))&&(s=s.match(/(.*?)\.(.*)/))&&(r.file=s[0],r.filename=s[1],r.fileext=s[2]),a.match(/(.*):([0-9]+)$/)&&(s=a.match(/(.*):([0-9]+)$/),r.port=s[2],a=s[1]),a.match(/(.*?)@(.*)/)&&(s=a.match(/(.*?)@(.*)/),r.auth=s[1],a=s[2]),r.auth&&(s=r.auth.match(/(.*):(.*)/),r.user=s?s[1]:r.auth,r.pass=s?s[2]:void 0),r.hostname=a.toLowerCase(),"."===n.charAt(0))return t(n,r.hostname);e()&&(s=r.hostname.match(e()))&&(r.tld=s[3],r.domain=s[2]?s[2]+"."+s[3]:void 0,r.sub=s[1]||void 0);var o=r.port?":"+r.port:"";r.protocol=r.protocol||window.location.protocol.replace(":",""),r.port=r.port||("https"===r.protocol?"443":"80"),r.protocol=r.protocol||("443"===r.port?"https":"http"),r.basic=r.protocol+"://"+r.hostname+o}return n in r?r[n]:"{}"===n?r:""}}(),r.createString=function(e){for(var t=e,i=Math.random().toString(36).substr(2);i.length<t;)i+=Math.random().toString(36).substr(2);return i=i.substr(0,e)},r.createAesKey=function(){return r.createString(16)},r.generateEncryptyData=function(e,t){if(void 0===t)return e;var i=t.publicKey,n=t.version;if(void 0===i||void 0===n)return e;if("undefined"==typeof CryptoJS||"undefined"==typeof JSEncrypt)return e;var a=r.createAesKey();try{var s=CryptoJS.enc.Utf8.parse(a),o=CryptoJS.enc.Utf8.parse(JSON.stringify(e)),c=r.isUndefined(CryptoJS.pad.Pkcs7)?CryptoJS.pad.PKCS7:CryptoJS.pad.Pkcs7,u=CryptoJS.AES.encrypt(o,s,{mode:CryptoJS.mode.ECB,padding:c}).toString(),h=new JSEncrypt;h.setPublicKey(i);var l=h.encrypt(a);return!1===l?(v.warn("私钥加密失败，返回原数据"),e):{pkv:n,ekey:l,payload:u}}catch(e){v.warn("数据加密失败，返回原数据: "+e)}return e},r.getUtm=function(){var e={};return r.each(g,(function(t){var i=r.getQueryParam(location.href,t);i.length&&(e[t]=i)})),JSON.stringify(e)},r.getQueryParam=function(e,t){t=t.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]"),e=r.decodeURIComponent(e);var i=new RegExp("[\\?&]"+t+"=([^&#]*)").exec(e);return null===i||i&&"string"!=typeof i[1]&&i[1].length?"":r.decodeURIComponent(i[1])},r.indexOf=function(e,t){var i=e.indexOf;if(i)return i.call(e,t);for(var n=0;n<e.length;n++)if(t===e[n])return n;return-1};var v="object"===e(v)?v:{};v.info=function(){if("object"===("undefined"==typeof console?"undefined":e(console))&&console.log&&v.enabled)try{return console.log.apply(console,arguments)}catch(e){console.log(arguments[0])}},v.warn=function(){if("object"===("undefined"==typeof console?"undefined":e(console))&&console.log&&v.enabled)try{return console.warn.apply(console,arguments)}catch(e){console.warn(arguments[0])}};var m=function(){function e(){t(this,e),this.config={persistenceName:"thinkingdata",persistenceNameOld:"thinkingdata_mg"}}return n(e,[{key:"getConfig",value:function(){return this.config}},{key:"getStorage",value:function(e,t,i){var n=localStorage.getItem(e);if(!t)return r.isJSONString(n)?JSON.parse(n):{};r.isJSONString(n)?i(JSON.parse(n)):i({})}},{key:"setStorage",value:function(e,t){localStorage.setItem(e,t)}},{key:"removeStorage",value:function(e){localStorage.removeItem(e)}},{key:"_setSystemProxy",value:function(e){this._sysCallback=e}},{key:"getSystemInfo",value:function(e){var t={mp_platform:"web",system:this._getOs(),screenWidth:window.screen.width,screenHeight:window.screen.height,systemLanguage:navigator.language};this._sysCallback&&(t=r.extend(t,this._sysCallback(e))),e.success(t),e.complete()}},{key:"_getOs",value:function(){var e=navigator.userAgent;return/Windows/i.test(e)?/Phone/.test(e)||/WPDesktop/.test(e)?"Windows Phone":"Windows":/(iPhone|iPad|iPod)/.test(e)?"iOS":/Android/.test(e)?"Android":/(BlackBerry|PlayBook|BB10)/i.test(e)?"BlackBerry":/Mac/i.test(e)?"MacOS":/Linux/.test(e)?"Linux":/CrOS/.test(e)?"ChromeOS":""}},{key:"getNetworkType",value:function(e){e.complete()}},{key:"onNetworkStatusChange",value:function(){}},{key:"request",value:function(e){var t={},i=new XMLHttpRequest;if(i.open(e.method,e.url),e.header)for(var n in e.header)i.setRequestHeader(n,e.header[n]);return i.onreadystatechange=function(){4===i.readyState&&200===i.status?(t.statusCode=200,r.isJSONString(i.responseText)&&(t.data=JSON.parse(i.responseText)),e.success(t)):200!==i.status&&(t.errMsg="network error",e.fail(t))},i.ontimeout=function(){t.errMsg="timeout",e.fail(t)},i.send(e.data),i}},{key:"initAutoTrackInstance",value:function(e,t){this.instance=e,this.autoTrack=t.autoTrack;var i=this;"onpagehide"in window?window.onpagehide=function(){i.onPageHide(!0)}:window.onbeforeunload=function(){i.onPageHide(!0)},i.onPageShow(),i.autoTrack.appHide&&i.instance.timeEvent("ta_page_hide"),"onvisibilitychange"in document&&(document.onvisibilitychange=function(){document.hidden?i.onPageHide(!1):(i.onPageShow(),i.autoTrack.appHide&&i.instance.timeEvent("ta_page_hide"))})}},{key:"setGlobal",value:function(e,t){window[t]=e}},{key:"getAppOptions",value:function(){}},{key:"showToast",value:function(){}},{key:"onPageShow",value:function(){if(this.autoTrack.appShow){var e={};r.extend(e,this.autoTrack.properties),r.isFunction(this.autoTrack.callback)&&r.extend(e,this.autoTrack.callback("appShow")),this.instance._internalTrack("ta_page_show",e)}}},{key:"onPageHide",value:function(e){if(this.autoTrack.appHide){var t={};r.extend(t,this.autoTrack.properties),r.isFunction(this.autoTrack.callback)&&r.extend(t,this.autoTrack.callback("appHide")),this.instance._internalTrack("ta_page_hide",t,new Date,null,e)}}}],[{key:"createInstance",value:function(){return new e}}]),e}(),y=function(){function e(i,n){if(t(this,e),this.taInstance=i,this.config=n||{},this.referrer="Directly open",this.config.isPlugin)i.App=function(){App.apply(this,arguments)},inension(i.Page);else{var a=App;App=this._initAppExtention(a);var s=Page;Page=this._initPageExtension(s)}}return n(e,[{key:"_initPageExtension",value:function(e){var t=this;return function(i){var n=i.onShow,a=i.onShareAppMessage;return i.onShow=function(e){t.onPageShow(),"function"==typeof n&&n.call(this,e)},"function"==typeof a&&(i.onShareAppMessage=function(e){var i=a.call(this,e);return t.onPageShare(i)}),e(i)}}},{key:"_initAppExtention",value:function(e){var t=this;return function(i){var n=i.onLaunch,a=i.onShow,s=i.onHide;return i.onLaunch=function(e){t.onAppLaunch(e,this),"function"==typeof n&&n.call(this,e)},i.onShow=function(e){t.onAppShow(e),"function"==typeof a&&a.call(this,e)},i.onHide=function(){t.onAppHide(),"function"==typeof s&&s.call(this)},e(i)}}},{key:"onAppLaunch",value:function(e,t){if(this._setAutoTrackProperties(e),r.isUndefined(t)||(t[this.taInstance.name]=this.taInstance),this.config.appLaunch){var i={};e&&e.path&&(i["#url_path"]=this._getPath(e.path)),this.taInstance._internalTrack("ta_mp_launch",i)}}},{key:"onAppShow",value:function(e){if(this.config.appHide&&this.taInstance.timeEvent("ta_mp_hide"),this._setAutoTrackProperties(e),this.config.appShow){var t={};e&&e.path&&(t["#url_path"]=this._getPath(e.path)),r.extend(t,this.config.properties),r.isFunction(this.config.callback)&&r.extend(t,this.config.callback("appShow")),this.taInstance._internalTrack("ta_mp_show",t)}}},{key:"onAppHide",value:function(){if(this.config.appHide){var e={"#url_path":this._getCurrentPath()};r.extend(e,this.config.properties),r.isFunction(this.config.callback)&&r.extend(e,this.config.callback("appHide")),this.taInstance._internalTrack("ta_mp_hide",e)}}},{key:"_getCurrentPath",value:function(){var e="Not to get";try{var t=getCurrentPages();e=t[t.length-1].route}catch(e){v.info(e)}return e}},{key:"_setAutoTrackProperties",value:function(e){var t={"#scene":e.scene};this.taInstance._setAutoTrackProperties(t)}},{key:"_getPath",value:function(e){return"string"==typeof e?e.replace(/^\//,""):"Abnormal values"}},{key:"onPageShare",value:function(e){return this.config.pageShare&&this.taInstance._internalTrack("ta_mp_share",{"#url_path":this._getCurrentPath()}),r.isObject(e)?e:{}}},{key:"onPageShow",value:function(){if(this.config.pageShow){var e=this._getCurrentPath(),t={"#url_path":e||"The system did not get a value","#referrer":this.referrer};this.referrer=e,this.taInstance._internalTrack("ta_mp_view",t)}}}]),e}(),k=function(){function e(i,n,a){var s=this;t(this,e),this.taInstance=i,this.config=n||{};var o=a.getLaunchOptionsSync();this._onShow(o),this.startTracked=!0,a.onShow((function(e){s._onShow(e)})),a.onHide((function(){if(s.startTracked=!1,s.config.appHide){var e={};r.extend(e,s.config.properties),r.isFunction(s.config.callback)&&r.extend(e,s.config.callback("appHide")),s.taInstance._internalTrack("ta_mg_hide",e)}}))}return n(e,[{key:"_onShow",value:function(e){if(!this.startTracked&&(this.config.appHide&&this.taInstance.timeEvent("ta_mg_hide"),e&&e.scene&&this.taInstance._setAutoTrackProperties({"#scene":e.scene}),this.config.appShow)){var t={};r.extend(t,this.config.properties),r.isFunction(this.config.callback)&&r.extend(t,this.config.callback("appShow")),this.taInstance._internalTrack("ta_mg_show",t)}}}]),e}(),_=function(){function e(i,n,a){t(this,e),this.api=i,this.config=n,this._config=a}return n(e,[{key:"getConfig",value:function(){return this.config}},{key:"getStorage",value:function(e,t,i){if(!t){if("dd_mp"===this._config.platform){var n=this.api.getStorageSync({key:e});return r.isJSONString(n.data)?JSON.parse(n.data):{}}var a=this.api.getStorageSync(e);return r.isJSONString(a)?JSON.parse(a):{}}this.api.getStorage({key:e,success:function(e){var t=r.isJSONString(e.data)?JSON.parse(e.data):{};i(t)},fail:function(){v.warn("getStorage faild"),i({})}})}},{key:"setStorage",value:function(e,t){this.api.setStorage({key:e,data:t})}},{key:"removeStorage",value:function(e){r.isFunction(this.api.removeStorage)?this.api.removeStorage({key:e}):r.isFunction(this.api.deleteStorage)&&this.api.deleteStorage({key:e})}},{key:"_getPlatform",value:function(){return""}},{key:"getSystemInfo",value:function(e){var t=this._config.mpPlatform;this.api.getSystemInfo({success:function(i){r.isFunction(t)?i.mp_platform=t(i):i.mp_platform=t,e.success(i),"wechat"===t&&e.complete()},complete:function(){e.complete()}})}},{key:"getNetworkType",value:function(e){r.isFunction(this.api.getNetworkType)?this.api.getNetworkType({success:function(t){e.success(t)},complete:function(){e.complete()}}):(e.success({}),e.complete())}},{key:"onNetworkStatusChange",value:function(e){r.isFunction(this.api.onNetworkStatusChange)?this.api.onNetworkStatusChange(e):e({})}},{key:"request",value:function(e){if("ali_mp"===this._config.platform||"dd_mp"===this._config.platform){var t=r.extend({},e);return t.headers=e.header,t.success=function(t){t.statusCode=t.status,e.success(t)},t.fail=function(t){t.errMsg=t.errorMessage,e.fail(t)},"dd_mp"===this._config.platform?this.api.httpRequest(t):this.api.request(t)}return this.api.request(e)}},{key:"initAutoTrackInstance",value:function(e,t){return r.isObject(t.autoTrack)&&(t.autoTrack.isPlugin=t.is_plugin),this._config.mp?new y(e,t.autoTrack,this.api):new k(e,t.autoTrack,this.api)}},{key:"setGlobal",value:function(e,t){this._config.mp?v.warn("ThinkingAnalytics: we do not set global name for TA instance when you do not enable auto track."):GameGlobal[t]=e}},{key:"getAppOptions",value:function(e){var t={};try{t=this.api.getLaunchOptionsSync()}catch(e){v.warn("Cannot get launch options.")}if(r.isFunction(e))try{this._config.mp?this.api.onAppShow(e):this.api.onShow(e)}catch(e){v.warn("Cannot register onShow callback.")}return t}},{key:"showToast",value:function(e){if(r.isFunction(this.api.showToast)){var t={title:e};"dd_mp"!==this._config.platform&&"ali_mp"!==this._config.platform||(t.content=e),this.api.showToast(t)}}}],[{key:"createInstance",value:function(){return this._createInstance("R_CURRENT_PLATFORM")}},{key:"_createInstance",value:function(t){switch(t){case"wechat_mp":return new e(wx,{persistenceName:"thinkingdata",persistenceNameOld:"thinkingdata_wechat"},{mpPlatform:"wechat",mp:!0,platform:t});case"wechat_mg":return new e(wx,{persistenceName:"thinkingdata",persistenceNameOld:"thinkingdata_wechat_game"},{mpPlatform:"wechat",platform:t});case"qq_mp":return new e(qq,{persistenceName:"thinkingdata",persistenceNameOld:"thinkingdata_qq"},{mpPlatform:"qq",mp:!0,platform:t});case"qq_mg":return new e(qq,{persistenceName:"thinkingdata",persistenceNameOld:"thinkingdata_qq_game"},{mpPlatform:"qq",platform:t});case"baidu_mp":return new e(swan,{persistenceName:"thinkingdata",persistenceNameOld:"thinkingdata_swan"},{mpPlatform:function(e){return e.host},mp:!0,platform:t});case"baidu_mg":return new e(swan,{persistenceName:"thinkingdata",persistenceNameOld:"thinkingdata_swan_game"},{mpPlatform:function(e){return e.host},platform:t});case"tt_mg":return new e(tt,{persistenceName:"thinkingdata",persistenceNameOld:"thinkingdata_tt_game"},{mpPlatform:function(e){return e.appName},platform:t});case"tt_mp":return new e(tt,{persistenceName:"thinkingdata",persistenceNameOld:"thinkingdata_tt"},{mpPlatform:function(e){return e.appName},mp:!0,platform:t});case"ali_mp":return new e(my,{persistenceName:"thinkingdata",persistenceNameOld:"thinkingdata_ali"},{mpPlatform:function(e){return e.app},mp:!0,platform:t});case"dd_mp":return new e(dd,{persistenceName:"thinkingdata",persistenceNameOld:"thinkingdata_dd"},{mpPlatform:"dingding",mp:!0,platform:t});case"bl_mg":return new e(bl,{persistenceName:"thinkingdata",persistenceNameOld:"thinkingdata_mg"},{mpPlatform:"bilibili",platform:t});case"kuaishou_mp":return new e(ks,{persistenceName:"thinkingdata",persistenceNameOld:"thinkingdata_kuaishou"},{mpPlatform:"kuaishou",mp:!0,platform:t});case"qh360_mg":return new e(qh,{persistenceName:"thinkingdata",persistenceNameOld:"thinkingdata_qh360"},{mpPlatform:"qh360",platform:t});case"tb_mp":return new e(my,{persistenceName:"thinkingdata",persistenceNameOld:"thinkingdata_tb"},{mpPlatform:"tb",mp:!0,platform:t});case"jd_mp":return new e(jd,{persistenceName:"thinkingdata",persistenceNameOld:"thinkingdata_jd"},{mpPlatform:"jd",mp:!0,platform:t});case"qh360_mp":return new e(qh,{persistenceName:"thinkingdata",persistenceNameOld:"thinkingdata_qh360"},{mpPlatform:"qh360",mp:!0,platform:t});case"WEB":return new m.createInstance}}}]),e}(),b=function e(i,n){var a=this;t(this,e),this.taInstance=i,this.config=n||{},this.config.appShow&&this.taInstance._internalTrack("ta_mg_show"),this.config.appHide&&this.taInstance.timeEvent("ta_mg_hide"),qg.onShow((function(){if(a.config.appHide&&a.taInstance.timeEvent("ta_mg_hide"),a.config.appShow){var e={};r.extend(e,a.config.properties),r.isFunction(a.config.callback)&&r.extend(e,a.config.callback("appShow")),a.taInstance._internalTrack("ta_mg_show")}})),qg.onHide((function(){if(a.config.appHide){var e={};r.extend(e,a.config.properties),r.isFunction(a.config.callback)&&r.extend(e,a.config.callback("appHide")),a.taInstance._internalTrack("ta_mg_hide")}}))},S=function(){function e(){t(this,e),this.config={persistenceName:"thinkingdata",persistenceNameOld:"thinkingdata_qg_vivo_game",asyncPersistence:!0}}return n(e,[{key:"getConfig",value:function(){return this.config||{}}},{key:"getStorage",value:function(e,t,i){if(!t){var n=qg.getStorageSync({key:e});return r.isJSONString(n)?JSON.parse(n):{}}qg.getStorage({key:e,success:function(e){var t=r.isJSONString(e)?JSON.parse(e):{};i(t)},fail:function(){i({})}})}},{key:"setStorage",value:function(e,t){qg.setStorage({key:e,value:t})}},{key:"removeStorage",value:function(e){qg.deleteStorage({key:e})}},{key:"getSystemInfo",value:function(e){qg.getSystemInfo({success:function(t){var i=t,n=[t.osType,t.osVersionName].join(" ");i.brand=t.manufacturer,i.system=n,i.mp_platform="vivo_qg",e.success(i)},complete:function(){e.complete()}})}},{key:"getNetworkType",value:function(e){qg.getNetworkType({success:function(t){var i=t;i.networkType=t.type,e.success(i)},complete:function(){e.complete()}})}},{key:"onNetworkStatusChange",value:function(e){qg.subscribeNetworkStatus({callback:function(t){var i=t;i.networkType=t.type,e(i)}})}},{key:"request",value:function(e){return qg.request({url:e.url,data:e.data,method:e.method,header:e.header,success:function(t){e.success(t)},fail:function(t){e.fail(t)}})}},{key:"initAutoTrackInstance",value:function(e,t){return new b(e,t.autoTrack)}},{key:"setGlobal",value:function(e,t){globalThis[t]=e}},{key:"getAppOptions",value:function(){return{}}},{key:"showToast",value:function(e){qg.showToast({message:e,duration:0})}}],[{key:"createInstance",value:function(){return new e}}]),e}(),I=function e(i,n,a){var s=this;if(t(this,e),this.taInstance=i,this.config=n||{},this.config.appShow){var o={};r.extend(o,this.config.properties),r.isFunction(this.config.callback)&&r.extend(o,this.config.callback("appShow")),this.taInstance._internalTrack("ta_mg_show",o)}this.config.appHide&&this.taInstance.timeEvent("ta_mg_hide"),a.onShow((function(){if(s.config.appHide&&s.taInstance.timeEvent("ta_mg_hide"),s.config.appShow){var e={};r.extend(e,s.config.properties),r.isFunction(s.config.callback)&&r.extend(e,s.config.callback("appShow")),s.taInstance._internalTrack("ta_mg_show",e)}})),a.onHide((function(){if(s.config.appHide){var e={};r.extend(e,s.config.properties),r.isFunction(s.config.callback)&&r.extend(e,s.config.callback("appHide")),s.taInstance._internalTrack("ta_mg_hide",e)}}))},P=function(){function e(i,n,a){t(this,e),this.api=i,this.config=n,this._config=a}return n(e,[{key:"getConfig",value:function(){return this.config||{}}},{key:"getStorage",value:function(e,t,i){var n=localStorage.getItem(e);if(!t)return r.isJSONString(n)?JSON.parse(n):{};r.isJSONString(n)?i(JSON.parse(n)):i({})}},{key:"setStorage",value:function(e,t){localStorage.setItem(e,t)}},{key:"removeStorage",value:function(e){localStorage.removeItem(e)}},{key:"getSystemInfo",value:function(e){var t=this._config.mpPlatform;this.api.getSystemInfo({success:function(i){i.mp_platform=t,e.success(i)},complete:function(){e.complete()}})}},{key:"getNetworkType",value:function(e){this.api.getNetworkType({success:function(t){e.success(t)},complete:function(){e.complete()}})}},{key:"onNetworkStatusChange",value:function(e){this.api.onNetworkStatusChange({callback:function(t){e(t)}})}},{key:"request",value:function(e){var t={},i=new XMLHttpRequest;if(i.open(e.method,e.url),e.header)for(var n in e.header)i.setRequestHeader(n,e.header[n]);return i.onreadystatechange=function(){4===i.readyState&&200===i.status?(t.statusCode=200,r.isJSONString(i.responseText)&&(t.data=JSON.parse(i.responseText)),e.success(t)):200!==i.status&&(t.errMsg="network error",e.fail(t))},i.ontimeout=function(){t.errMsg="timeout",e.fail(t)},i.send(e.data),i}},{key:"initAutoTrackInstance",value:function(e,t){return new I(e,t.autoTrack,this.api)}},{key:"setGlobal",value:function(e,t){globalThis[t]=e}},{key:"getAppOptions",value:function(){return this.api.getLaunchOptionsSync()}},{key:"showToast",value:function(e){this.api.showToast({title:e,icon:"none",duration:2e3})}}],[{key:"createInstance",value:function(){return this._createInstance("R_CURRENT_PLATFORM")}},{key:"_createInstance",value:function(t){switch(t){case"oppo":return new e(qg,{persistenceName:"thinkingdata",persistenceNameOld:"thinkingdata_qg_oppo_game"},{mpPlatform:"oppo_qg"});case"huawei":return new e(hbs,{persistenceName:"thinkingdata",persistenceNameOld:"thinkingdata_qg_huawei_game"},{mpPlatform:"huawei_qg"});case"mz":return new e(qg,{persistenceName:"thinkingdata",persistenceNameOld:"thinkingdata_qg_mz_game"},{mpPlatform:"mz"});case"xiaomi":return new e(qg,{persistenceName:"thinkingdata",persistenceNameOld:"thinkingdata_qg"},{mpPlatform:"xiaomi"})}}}]),e}(),w=function(){function e(){t(this,e)}return n(e,null,[{key:"createInstance",value:function(){return Laya.Browser.onMiniGame?_._createInstance("wechat_mg"):Laya.Browser.onBDMiniGame?_._createInstance("baidu_mg"):Laya.Browser.onVVMiniGame?S.createInstance():Laya.Browser.onQQMiniGame?_._createInstance("qq_mg"):Laya.Browser.onQGMiniGame?P._createInstance("oppo"):Laya.Browser.onHWMiniGame?P._createInstance("huawei"):Laya.Browser.onKGMiniGame?P._createInstance("xiaomi"):Laya.Browser.onTTMiniGame?_._createInstance("tt_mg"):Laya.Browser.onBLMiniGame?_._createInstance("bl_mg"):Laya.Browser.onAlipayMiniGame?_._createInstance("ali_mp"):Laya.Browser.onTBMiniGame?_._createInstance("tb_mp"):m.createInstance()}}]),e}(),N=function(){function e(){t(this,e)}return n(e,null,[{key:"_getCurrentPlatform",value:function(){return this.currentPlatform||(this.currentPlatform=w.createInstance())}},{key:"getConfig",value:function(){return this._getCurrentPlatform().getConfig()}},{key:"getStorage",value:function(e,t,i){return this._getCurrentPlatform().getStorage(e,t,i)}},{key:"setStorage",value:function(e,t){return this._getCurrentPlatform().setStorage(e,t)}},{key:"removeStorage",value:function(e){return this._getCurrentPlatform().removeStorage(e)}},{key:"getSystemInfo",value:function(e){return this._getCurrentPlatform().getSystemInfo(e)}},{key:"getNetworkType",value:function(e){return this._getCurrentPlatform().getNetworkType(e)}},{key:"onNetworkStatusChange",value:function(e){this._getCurrentPlatform().onNetworkStatusChange(e)}},{key:"request",value:function(e){return this._getCurrentPlatform().request(e)}},{key:"initAutoTrackInstance",value:function(e,t){return this._getCurrentPlatform().initAutoTrackInstance(e,t)}},{key:"setGlobal",value:function(e,t){e&&t&&this._getCurrentPlatform().setGlobal(e,t)}},{key:"getAppOptions",value:function(e){return this._getCurrentPlatform().getAppOptions(e)}},{key:"showDebugToast",value:function(e){this._getCurrentPlatform().showToast(e)}}]),e}(),O=/^[a-zA-Z][a-zA-Z0-9_]{0,49}$/,x=function(){function e(){t(this,e)}return n(e,null,[{key:"stripProperties",value:function(e){return r.isObject(e)?(r.each(e,(function(e,t){r.isString(e)||r.isNumber(e)||r.isDate(e)||r.isBoolean(e)||r.isArray(e)||r.isObject(e)||v.warn("Your data -",t,e,"- format does not meet requirements and may not be stored correctly. Attribute values only support String, Number, Date, Boolean, Array, Object")})),e):e}},{key:"_checkPropertiesKey",value:function(e){var t=!0;return r.each(e,(function(e,i){O.test(i)||(v.warn("Invalid KEY: "+i),t=!1)})),t}},{key:"event",value:function(e){return!(!r.isString(e)||!O.test(e))||(v.warn("Check the parameter format. The eventName must start with an English letter and contain no more than 50 characters including letters, digits, and underscores: "+e),!1)}},{key:"propertyName",value:function(e){return!(!r.isString(e)||!O.test(e))||(v.warn("Check the parameter format. PropertyName must start with a letter and contain letters, digits, and underscores (_). The value is a string of no more than 50 characters: "+e),!1)}},{key:"properties",value:function(e){return this.stripProperties(e),!e||(r.isObject(e)?!!this._checkPropertiesKey(e)||(v.warn("Check the parameter format. The properties key must start with a letter, contain digits, letters, and underscores (_), and contain a maximum of 50 characters"),!1):(v.warn("properties can be none, but it must be an object"),!1))}},{key:"propertiesMust",value:function(e){return this.stripProperties(e),void 0===e||!r.isObject(e)||r.isEmptyObject(e)?(v.warn("properties must be an object with a value"),!1):!!this._checkPropertiesKey(e)||(v.warn("Check the parameter format. The properties key must start with a letter, contain digits, letters, and underscores (_), and contain a maximum of 50 characters"),!1)}},{key:"userId",value:function(e){return!(!r.isString(e)||!/^.{1,64}$/.test(e))||(v.warn("The user ID must be a string of less than 64 characters and cannot be null"),!1)}},{key:"userAddProperties",value:function(e){if(!this.propertiesMust(e))return!1;for(var t in e)if(!r.isNumber(e[t]))return v.warn("The attributes of userAdd need to be Number"),!1;return!0}},{key:"userAppendProperties",value:function(e){if(!this.propertiesMust(e))return!1;for(var t in e)if(!r.isArray(e[t]))return v.warn("The attribute of userAppend must be Array"),!1;return!0}}]),e}(),T=function(){function e(i,n,a,s,o){t(this,e),this.data=i,this.serverUrl=n,this.callback=o,this.tryCount=r.isNumber(a)?a:1,this.timeout=r.isNumber(s)?s:3e3,this.taClassName="HttpTask"}return n(e,[{key:"run",value:function(){var e=this,t=r.createExtraHeaders();t["content-type"]="application/json";var i=N.request({url:this.serverUrl,method:"POST",data:this.data,header:t,success:function(t){e.onSuccess(t)},fail:function(t){e.onFailed(t)}});setTimeout((function(){(r.isObject(i)||r.isPromise(i))&&r.isFunction(i.abort)&&i.abort()}),this.timeout)}},{key:"onSuccess",value:function(e){if(200===e.statusCode){var t;switch(e.data.code){case 0:t="success";break;case-1:t="invalid data";break;case-2:t="invalid APP ID";break;default:t="Unknown return code"}this.callback({code:e.data.code,msg:t})}else this.callback({code:-3,msg:e.statusCode})}},{key:"onFailed",value:function(e){--this.tryCount>0?this.run():this.callback({code:-3,msg:e.errMsg})}}]),e}(),A=function(){function e(i,n,a,s,o,c,u){t(this,e),this.data=i,this.serverDebugUrl=n,this.callback=u,this.tryCount=r.isNumber(a)?a:1,this.timeout=r.isNumber(s)?s:3e3,this.dryrun=o,this.deviceId=c,this.taClassName="HttpTaskDebug"}return n(e,[{key:"run",value:function(){var e=this,t="appid="+this.data["#app_id"]+"&source=client&dryRun="+this.dryrun+"&deviceId="+this.deviceId+"&data="+encodeURIComponent(JSON.stringify(this.data.data[0])),i=r.createExtraHeaders();i["content-type"]="application/x-www-form-urlencoded";var n=N.request({url:this.serverDebugUrl,method:"POST",data:t,header:i,success:function(t){e.onSuccess(t)},fail:function(t){e.onFailed(t)}});setTimeout((function(){(r.isObject(n)||r.isPromise(n))&&r.isFunction(n.abort)&&n.abort()}),this.timeout)}},{key:"onSuccess",value:function(e){if(200===e.statusCode){var t;if(0===e.data.errorLevel)t="Verify data success.";else if(1===e.data.errorLevel){for(var i=e.data.errorProperties,n="",a=0;a<i.length;a++){var s=i[a].errorReason;n=n+" propertyName:"+i[a].propertyName+" errorReasons:"+s+"\n"}t="Debug data error. errorLevel:"+e.data.errorLevel+" reason:"+n}else 2!==e.data.errorLevel&&-1!==e.data.errorLevel||(t="Debug data error. errorLevel:"+e.data.errorLevel+" reason:"+e.data.errorReasons);v.info(t),this.callback({code:e.data.errorLevel,msg:t})}else this.callback({code:-3,msg:e.statusCode})}},{key:"onFailed",value:function(e){--this.tryCount>0?this.run():this.callback({code:-3,msg:e.errMsg})}}]),e}(),C=new(function(){function e(){t(this,e),this.items=[],this.isRunning=!1,this.showDebug=!1}return n(e,[{key:"enqueue",value:function(e,t,i){var n,a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],s=this;n="debug"===i.debugMode?new A(e,t,i.maxRetries,i.sendTimeout,0,i.deviceId,(function(e){s.isRunning=!1,r.isFunction(i.callback)&&i.callback(e),s._runNext(),!1===s.showDebug&&(0!==e.code&&1!==e.code&&2!==e.code||(s.showDebug=!0,r.isFunction(N.showDebugToast)&&N.showDebugToast("The current mode is Debug")))})):"debugOnly"===i.debugMode?new A(e,t,i.maxRetries,i.sendTimeout,1,i.deviceId,(function(e){s.isRunning=!1,r.isFunction(i.callback)&&i.callback(e),s._runNext(),!1===s.showDebug&&(0!==e.code&&1!==e.code&&2!==e.code||(s.showDebug=!0,r.isFunction(N.showDebugToast)&&N.showDebugToast("The current mode is debugOnly")))})):new T(JSON.stringify(e),t,i.maxRetries,i.sendTimeout,(function(e){s.isRunning=!1,r.isFunction(i.callback)&&i.callback(e),s._runNext()})),!0===a?(this.items.push(n),this._runNext()):n.run()}},{key:"_dequeue",value:function(){return this.items.shift()}},{key:"_runNext",value:function(){if(this.items.length>0&&!this.isRunning)if(this.isRunning=!0,"HttpTask"!==this.items[0].taClassName)this._dequeue().run();else{var e=this.items.splice(0,this.items.length),t=e[0],i=JSON.parse(t.data),n=i["#app_id"],a=[];a.push(t.callback);for(var s=1;s<e.length;s++){var r=e[s],o=JSON.parse(r.data);o["#app_id"]===n&&t.serverUrl===r.serverUrl?(i.data=i.data.concat(o.data),a.push(r.callback)):this.items.push(r)}var c=(new Date).getTime();i["#flush_time"]=c,new T(JSON.stringify(i),t.serverUrl,t.tryCount,t.timeout,(function(e){for(var t in a){if(Object.hasOwnProperty.call(a,t))(0,a[t])(e)}})).run()}}}]),e}()),U={name:"thinkingdata",is_plugin:!1,maxRetries:3,sendTimeout:3e3,enablePersistence:!0,asyncPersistence:!1,enableLog:!0,strict:!1,debugMode:"none"},D={properties:{"#lib":s,"#lib_version":a},initDeviceId:function(e){r.isString(e)&&(this.properties["#device_id"]=e)},getSystemInfo:function(e){var t=this;N.onNetworkStatusChange((function(e){t.properties["#network_type"]=e.networkType})),N.getNetworkType({success:function(e){t.properties["#network_type"]=e.networkType},complete:function(){N.getSystemInfo({success:function(e){v.info(JSON.stringify(e,null,4));var i=e.system?e.system.replace(/\s+/g," ").split(" "):[],n={"#manufacturer":e.brand,"#device_model":e.model,"#screen_width":Number(e.screenWidth),"#screen_height":Number(e.screenHeight),"#os":i[0],"#os_version":i[1],"#mp_platform":e.mp_platform,"#system_language":e.systemLanguage,"#utm":r.getUtm()};r.extend(t.properties,n),r.setMpPlatform(e.mp_platform)},complete:function(){e()}})}})}},F=function(){function i(e,n){var a=this;t(this,i),this.enabled=e.enablePersistence,this.enabled?(e.isChildInstance?(this.name=e.persistenceName+"_"+e.name,this.nameOld=e.persistenceNameOld+"_"+e.name):(this.name=e.persistenceName,this.nameOld=e.persistenceNameOld),e.asyncPersistence?(this._state={},N.getStorage(this.name,!0,(function(t){r.isEmptyObject(t)?N.getStorage(a.nameOld,!0,(function(t){a._state=r.extend2Layers({},t,a._state),a._init(e,n),a._save()})):(a._state=r.extend2Layers({},t,a._state),a._init(e,n),a._save())}))):(this._state=N.getStorage(this.name)||{},r.isEmptyObject(this._state)&&(this._state=N.getStorage(this.nameOld)||{}),this._init(e,n))):(this._state={},this._init(e,n))}return n(i,[{key:"_init",value:function(e,t){this.getDistinctId()||this.setDistinctId(r.UUID()),e.isChildInstance||(this.getDeviceId()||this._setDeviceId(r.UUID()),D.initDeviceId(this.getDeviceId())),this.initComplete=!0,"function"==typeof t&&t(),this._save()}},{key:"_save",value:function(){this.enabled&&this.initComplete&&N.setStorage(this.name,JSON.stringify(this._state))}},{key:"_set",value:function(t,i){var n,a=this;"string"==typeof t?(n={})[t]=i:"object"===e(t)&&(n=t),r.each(n,(function(e,t){a._state[t]=e})),this._save()}},{key:"_get",value:function(e){return this._state[e]}},{key:"setEventTimer",value:function(e,t){var i=this._state.event_timers||{};i[e]=t,this._set("event_timers",i)}},{key:"removeEventTimer",value:function(e){var t=(this._state.event_timers||{})[e];return r.isUndefined(t)||(delete this._state.event_timers[e],this._save()),t}},{key:"getDeviceId",value:function(){return this._state.device_id}},{key:"_setDeviceId",value:function(e){this.getDeviceId()?v.warn("cannot modify the device id."):this._set("device_id",e)}},{key:"getDistinctId",value:function(){return this._state.distinct_id}},{key:"setDistinctId",value:function(e){this._set("distinct_id",e)}},{key:"getAccountId",value:function(){return this._state.account_id}},{key:"setAccountId",value:function(e){this._set("account_id",e)}},{key:"getSuperProperties",value:function(){return this._state.props||{}}},{key:"setSuperProperties",value:function(e,t){var i=t?e:r.extend(this.getSuperProperties(),e);this._set("props",i)}}]),i}(),q=function(){function e(i,n){t(this,e),this.config=i,this.ta=n,this.timer=null,this.batchConfig=r.extend({size:5,interval:5e3,storageLimit:200},this.config.batchConfig),this.batchConfig.size<1&&(this.batchConfig.size=1),this.batchConfig.size>30&&(this.batchConfig.size=30),this.tabKey="tab_tampsdk_"+this.config.appId,this.storageLimit=this.batchConfig.storageLimit}return n(e,[{key:"batchInterval",value:function(){var e=this;e.timer=setTimeout((function(){e.recycle(),e.send(),clearTimeout(e.timer),e.batchInterval()}),this.batchConfig.interval)}},{key:"add",value:function(e){var t=e,i="tampsdk_"+this.config.appId+"_"+String(r.UUID()),n=N.getStorage(this.tabKey);if(null===n&&(n=[]),n.length<=this.storageLimit)n.push(i),N.setStorage(this.tabKey,JSON.stringify(n)),N.setStorage(i,JSON.stringify(t));else{var a=n.splice(0,20);console.log("删除的数据:"+a),n.push(i),N.setStorage(this.tabKey,JSON.stringify(n)),N.setStorage(i,JSON.stringify(t));for(var s={},o=[],c=0;c<a.length;c++){var u=N.getStorage(a[c]);o.push(u)}s.data=o,s["#app_id"]=this.config.appId,this.request(s,a)}}},{key:"flush",value:function(){clearTimeout(this.timer),this.send(),this.batchInterval()}},{key:"send",value:function(){var e=N.getStorage(this.tabKey);if(e&&e.length){for(var t={},i=[],n=[],a=e.length<this.batchConfig.size?e.length:this.batchConfig.size,s=0;s<a;s++){var r=N.getStorage(e[s]);i.push(r),n.push(e[s])}t.data=i,t["#app_id"]=this.config.appId,this.request(t,n)}}},{key:"request",value:function(e,t){var i=this;v.info("flush data: "+JSON.stringify(e)),C.enqueue(e,this.ta.serverUrl,{maxRetries:this.config.maxRetries,sendTimeout:this.config.sendTimeout,callback:function(e){i.remove(t)},debugMode:this.config.debugMode,deviceId:this.ta.getDeviceId()})}},{key:"remove",value:function(e){var t=N.getStorage(this.tabKey);if(t){for(var i=0;i<e.length;i++){var n=r.indexOf(t,e[i]);n>-1&&t.splice(n,1),N.removeStorage(e[i])}N.setStorage(this.tabKey,JSON.stringify(t))}}},{key:"recycle",value:function(){var e=N.getStorage(this.tabKey);if(e&&0===e.length){for(var t=0;t<localStorage.length;t++){var i=localStorage.key(t);0===i.indexOf("tampsdk_"+this.config.appId)&&e.push(i)}e.length>0&&N.setStorage(this.tabKey,JSON.stringify(e))}}}]),e}(),J=function(){function e(i){t(this,e),i.appId=i.appId?r.checkAppId(i.appId):r.checkAppId(i.appid),i.serverUrl=i.serverUrl?r.checkUrl(i.serverUrl):r.checkUrl(i.server_url);var n=r.extend({},U,N.getConfig());r.isObject(i)?this.config=r.extend(n,i):this.config=n,this._init(this.config)}return n(e,[{key:"_init",value:function(e){var t=this;this.name=e.name,this.appId=e.appId||e.appid;var i=e.serverUrl||e.server_url;this.serverUrl=i+"/sync_xcx",this.serverDebugUrl=i+"/data_debug",this.configUrl=i+"/config",this.autoTrackProperties={},this._queue=[],this.updateConfig(this.configUrl,this.appId),e.isChildInstance?this._state={}:(v.enabled=e.enableLog,this.instances=[],this._state={getSystemInfo:!1,initComplete:!1},D.getSystemInfo((function(){t._updateState({getSystemInfo:!0})})),N.setGlobal(this,this.name)),this.store=new F(e,(function(){t.config.asyncPersistence&&r.isFunction(t.config.persistenceComplete)&&t.config.persistenceComplete(t),t._updateState()})),this.enabled=!r.isBoolean(this.store._get("ta_enabled"))||this.store._get("ta_enabled"),this.isOptOut=!!r.isBoolean(this.store._get("ta_isOptOut"))&&this.store._get("ta_isOptOut"),!e.isChildInstance&&e.autoTrack&&(this.autoTrack=N.initAutoTrackInstance(this,e)),void 0!==this.config.enableBatch&&!1!==this.config.enableBatch&&(this.batchConsumer=new q(this.config,this),this.batchConsumer.batchInterval())}},{key:"updateConfig",value:function(e,t){var i=this,n=r.createExtraHeaders();n["content-type"]="application/json";var a=N.request({url:e+"?appid="+t,method:"GET",header:n,success:function(e){if(!(r.isUndefined(e)||r.isUndefined(e.data)||(v.info("config update success("+t+") :"+JSON.stringify(e.data)),r.isUndefined(e.data.data)||(i.config.syncBatchSize=e.data.data.sync_batch_size,i.config.syncInterval=e.data.data.sync_interval,i.config.disableEventList=e.data.data.disable_event_list,r.isUndefined(e.data.data.secret_key))))){var n=e.data.data.secret_key;i.config.secretKey={publicKey:n.key,version:n.version}}},fail:function(e){v.info("config update fail("+t+") :"+e.errMsg)}});setTimeout((function(){(r.isObject(a)||r.isPromise(a))&&r.isFunction(a.abort)&&a.abort()}),3e3)}},{key:"initInstance",value:function(t,i){if(this.config.isChildInstance)v.warn("initInstance() cannot be called on child instance");else{if(r.isString(t)&&t!==this.name&&r.isUndefined(this[t])){var n=new e(r.extend({},this.config,{enablePersistence:!1,isChildInstance:!0,name:t},i));return this[t]=n,this.instances.push(t),this[t]._state=this._state,n}v.warn("initInstance() failed due to the name is invalid: "+t)}}},{key:"lightInstance",value:function(e){return this[e]}},{key:"_setAutoTrackProperties",value:function(e){r.extend(this.autoTrackProperties,e)}},{key:"init",value:function(){if(this._state.initComplete)return!1;this._updateState({initComplete:!0})}},{key:"_isReady",value:function(){return this._state.getSystemInfo&&this._state.initComplete&&this.store.initComplete&&this.getDeviceId()}},{key:"_updateState",value:function(e){var t=this;r.isObject(e)&&r.extend(this._state,e),this._onStateChange(),r.each(this.instances,(function(e){t[e]._onStateChange()}))}},{key:"_onStateChange",value:function(){var e=this;this._isReady()&&this._queue&&this._queue.length>0&&(r.each(this._queue,(function(t){e[t[0]].apply(e,u.call(t[1]))})),this._queue=[])}},{key:"_hasDisabled",value:function(){var e=!this.enabled||this.isOptOut;return e&&v.info("ThinkingData is Pause or Stop!"),e}},{key:"_sendRequest",value:function(e,t,i){if(!this._hasDisabled())if(r.isUndefined(this.config.disableEventList)||!this.config.disableEventList.includes(e.eventName)){t=r.isDate(t)?t:new Date;var n={data:[{"#type":e.type,"#time":r.formatDate(t),"#distinct_id":this.store.getDistinctId()}]};if(this.store.getAccountId()&&(n.data[0]["#account_id"]=this.store.getAccountId()),"track"===e.type||"track_update"===e.type||"track_overwrite"===e.type){n.data[0]["#event_name"]=e.eventName,"track_update"===e.type||"track_overwrite"===e.type?n.data[0]["#event_id"]=e.extraId:e.firstCheckId&&(n.data[0]["#first_check_id"]=e.firstCheckId),n.data[0].properties=r.extend({"#zone_offset":0-t.getTimezoneOffset()/60},D.properties,this.autoTrackProperties,this.store.getSuperProperties(),this.dynamicProperties?this.dynamicProperties():{});var a=this.store.removeEventTimer(e.eventName);if(!r.isUndefined(a)){var s=(new Date).getTime()-a,o=parseFloat((s/1e3).toFixed(3));o>86400?o=86400:o<0&&(o=0),n.data[0].properties["#duration"]=o}}else n.data[0].properties={};r.isObject(e.properties)&&!r.isEmptyObject(e.properties)&&r.extend(n.data[0].properties,e.properties),r.searchObjDate(n.data[0]),this.config.maxRetries>1&&(n.data[0]["#uuid"]=r.UUIDv4()),n["#app_id"]=this.appId,v.info(JSON.stringify(n,null,4));var c="debug"===this.config.debugMode||"debugOnly"===this.config.debugMode?this.serverDebugUrl:this.serverUrl;if(r.isBoolean(this.config.enableEncrypt)&&1==this.config.enableEncrypt&&(n.data[0]=r.generateEncryptyData(n.data[0],this.config.secretKey)),this.batchConsumer&&"none"===this.config.debugMode&&!i)return this.batchConsumer.add(n.data[0]),void(r.isFunction(e.onComplete)&&e.onComplete({code:0,msg:"success"}));if(i){var u=new FormData;if("debug"===this.config.debugMode||"debugOnly"===this.config.debugMode)u.append("source","client"),u.append("appid",this.appId),u.append("dryRun","debugOnly"===this.config.debugMode?1:0),u.append("deviceId",this.getDeviceId()),u.append("data",JSON.stringify(n.data[0]));else{var h=r.base64Encode(JSON.stringify(n));u.append("data",h)}navigator.sendBeacon(c,u),r.isFunction(e.onComplete)&&e.onComplete({statusCode:200})}else C.enqueue(n,c,{maxRetries:this.config.maxRetries,sendTimeout:this.config.sendTimeout,callback:e.onComplete,debugMode:this.config.debugMode,deviceId:this.getDeviceId()})}else v.info("disabled Event : "+e.eventName)}},{key:"_isObjectParams",value:function(e){return r.isObject(e)&&r.isFunction(e.onComplete)}},{key:"track",value:function(e,t,i,n){if(!this._hasDisabled()){if(this._isObjectParams(e)){var a=e;e=a.eventName,t=a.properties,i=a.time,n=a.onComplete}x.event(e)&&x.properties(t)||!this.config.strict?this._internalTrack(e,t,i,n):r.isFunction(n)&&n({code:-1,msg:"invalid parameters"})}}},{key:"trackUpdate",value:function(e){if(!this._hasDisabled())if(e&&e.eventId&&(x.event(e.eventName)&&x.properties(e.properties)||!this.config.strict)){var t=r.isDate(e.time)?e.time:new Date;this._isReady()?this._sendRequest({type:"track_update",eventName:e.eventName,properties:e.properties,onComplete:e.onComplete,extraId:e.eventId},t):(e.time=t,this._queue.push(["trackUpdate",[e]]))}else v.warn("Invalide parameter for trackUpdate: you should pass an object contains eventId to trackUpdate()"),r.isFunction(e.onComplete)&&e.onComplete({code:-1,msg:"invalid parameters"})}},{key:"trackOverwrite",value:function(e){if(!this._hasDisabled())if(e&&e.eventId&&(x.event(e.eventName)&&x.properties(e.properties)||!this.config.strict)){var t=r.isDate(e.time)?e.time:new Date;this._isReady()?this._sendRequest({type:"track_overwrite",eventName:e.eventName,properties:e.properties,onComplete:e.onComplete,extraId:e.eventId},t):(e.time=t,this._queue.push(["trackOverwrite",[e]]))}else v.warn("Invalide parameter for trackOverwrite: you should pass an object contains eventId to trackOverwrite()"),r.isFunction(e.onComplete)&&e.onComplete({code:-1,msg:"invalid parameters"})}},{key:"trackFirstEvent",value:function(e){if(!this._hasDisabled())if(e&&e.eventName&&(x.event(e.eventName)&&x.properties(e.properties)||!this.config.strict)){var t=r.isDate(e.time)?e.time:new Date;this._isReady()?this._sendRequest({type:"track",eventName:e.eventName,properties:e.properties,onComplete:e.onComplete,firstCheckId:e.firstCheckId?e.firstCheckId:this.getDeviceId()},t):(e.time=t,this._queue.push(["trackFirstEvent",[e]]))}else v.warn("Invalide parameter for trackFirstEvent: you should pass an object contains eventName to trackFirstEvent()"),r.isFunction(e.onComplete)&&e.onComplete({code:-1,msg:"invalid parameters"})}},{key:"_internalTrack",value:function(e,t,i,n,a){this._hasDisabled()||(i=r.isDate(i)?i:new Date,this._isReady()?this._sendRequest({type:"track",eventName:e,properties:t,onComplete:n},i,a):this._queue.push(["_internalTrack",[e,t,i,n]]))}},{key:"userSet",value:function(e,t,i){if(!this._hasDisabled()){if(this._isObjectParams(e)){var n=e;e=n.properties,t=n.time,i=n.onComplete}x.propertiesMust(e)||!this.config.strict?(t=r.isDate(t)?t:new Date,this._isReady()?this._sendRequest({type:"user_set",properties:e,onComplete:i},t):this._queue.push(["userSet",[e,t,i]])):(v.warn("calling userSet failed due to invalid arguments"),r.isFunction(i)&&i({code:-1,msg:"invalid parameters"}))}}},{key:"userSetOnce",value:function(e,t,i){if(!this._hasDisabled()){if(this._isObjectParams(e)){var n=e;e=n.properties,t=n.time,i=n.onComplete}x.propertiesMust(e)||!this.config.strict?(t=r.isDate(t)?t:new Date,this._isReady()?this._sendRequest({type:"user_setOnce",properties:e,onComplete:i},t):this._queue.push(["userSetOnce",[e,t,i]])):(v.warn("calling userSetOnce failed due to invalid arguments"),r.isFunction(i)&&i({code:-1,msg:"invalid parameters"}))}}},{key:"userUnset",value:function(e,t,i){if(!this._hasDisabled()){if(this._isObjectParams(a)){var n=a;e=n.property,t=n.time,i=n.onComplete}if(x.propertyName(e)||!this.config.strict)if(t=r.isDate(t)?t:new Date,this._isReady()){var a={};a[e]=0,this._sendRequest({type:"user_unset",properties:a,onComplete:i},t)}else this._queue.push(["userUnset",[e,i,t]]);else v.warn("calling userUnset failed due to invalid arguments"),r.isFunction(i)&&i({code:-1,msg:"invalid parameters"})}}},{key:"userDel",value:function(e,t){if(!this._hasDisabled()){if(this._isObjectParams(e)){var i=e;e=i.time,t=i.onComplete}e=r.isDate(e)?e:new Date,this._isReady()?this._sendRequest({type:"user_del",onComplete:t},e):this._queue.push(["userDel",[e,t]])}}},{key:"userAdd",value:function(e,t,i){if(!this._hasDisabled()){if(this._isObjectParams(e)){var n=e;e=n.properties,t=n.time,i=n.onComplete}x.userAddProperties(e)||!this.config.strict?(t=r.isDate(t)?t:new Date,this._isReady()?this._sendRequest({type:"user_add",properties:e,onComplete:i},t):this._queue.push(["userAdd",[e,t,i]])):(v.warn("calling userAdd failed due to invalid arguments"),r.isFunction(i)&&i({code:-1,msg:"invalid parameters"}))}}},{key:"userAppend",value:function(e,t,i){if(!this._hasDisabled()){if(this._isObjectParams(e)){var n=e;e=n.properties,t=n.time,i=n.onComplete}x.userAppendProperties(e)||!this.config.strict?(t=r.isDate(t)?t:new Date,this._isReady()?this._sendRequest({type:"user_append",properties:e,onComplete:i},t):this._queue.push(["userAppend",[e,t,i]])):(v.warn("calling userAppend failed due to invalid arguments"),r.isFunction(i)&&i({code:-1,msg:"invalid parameters"}))}}},{key:"userUniqAppend",value:function(e,t,i){if(!this._hasDisabled()){if(this._isObjectParams(e)){var n=e;e=n.properties,t=n.time,i=n.onComplete}x.userAppendProperties(e)||!this.config.strict?(t=r.isDate(t)?t:new Date,this._isReady()?this._sendRequest({type:"user_uniq_append",properties:e,onComplete:i},t):this._queue.push(["userUniqAppend",[e,t,i]])):(v.warn("calling userAppend failed due to invalid arguments"),r.isFunction(i)&&i({code:-1,msg:"invalid parameters"}))}}},{key:"flush",value:function(){this.batchConsumer&&"none"===this.config.debugMode&&this.batchConsumer.flush()}},{key:"authorizeOpenID",value:function(e){this.identify(e)}},{key:"identify",value:function(e){if(!this._hasDisabled()){if("number"==typeof e)e=String(e);else if("string"!=typeof e)return!1;this.store.setDistinctId(e)}}},{key:"getDistinctId",value:function(){return this.store.getDistinctId()}},{key:"login",value:function(e){if(!this._hasDisabled()){if("number"==typeof e)e=String(e);else if("string"!=typeof e)return!1;this.store.setAccountId(e)}}},{key:"getAccountId",value:function(){return this.store.getAccountId()}},{key:"logout",value:function(){this._hasDisabled()||this.store.setAccountId(null)}},{key:"setSuperProperties",value:function(e){this._hasDisabled()||(x.propertiesMust(e)||!this.config.strict?this.store.setSuperProperties(e):v.warn("setSuperProperties parameter must be a valid property value"))}},{key:"clearSuperProperties",value:function(){this._hasDisabled()||this.store.setSuperProperties({},!0)}},{key:"unsetSuperProperty",value:function(e){if(!this._hasDisabled()&&r.isString(e)){var t=this.getSuperProperties();delete t[e],this.store.setSuperProperties(t,!0)}}},{key:"getSuperProperties",value:function(){return this.store.getSuperProperties()}},{key:"getPresetProperties",value:function(){var e=D.properties,t={},i=e["#os"];t.os=r.isUndefined(i)?"":i;var n=e["#screen_width"];t.screenWidth=r.isUndefined(n)?0:n;var a=e["#screen_height"];t.screenHeight=r.isUndefined(a)?0:a;var s=e["#network_type"];t.networkType=r.isUndefined(s)?"":s;var o=e["#device_model"];t.deviceModel=r.isUndefined(o)?"":o;var c=e["#os_version"];t.osVersion=r.isUndefined(c)?"":c,t.deviceId=this.getDeviceId();var u=0-(new Date).getTimezoneOffset()/60;t.zoneOffset=u;var h=e["#manufacturer"];return t.manufacturer=r.isUndefined(h)?"":h,t.toEventPresetProperties=function(){return{"#device_model":t.deviceModel,"#device_id":t.deviceId,"#screen_width":t.screenWidth,"#screen_height":t.screenHeight,"#os":t.os,"#os_version":t.osVersion,"#network_type":t.networkType,"#zone_offset":u,"#manufacturer":t.manufacturer}},t}},{key:"setDynamicSuperProperties",value:function(e){this._hasDisabled()||("function"==typeof e?x.properties(e())||!this.config.strict?this.dynamicProperties=e:v.warn("A dynamic public property must return a valid property value"):v.warn("setDynamicSuperProperties parameter must be a function type"))}},{key:"timeEvent",value:function(e,t){this._hasDisabled()||(t=r.isDate(t)?t:new Date,this._isReady()?x.event(e)||!this.config.strict?this.store.setEventTimer(e,t.getTime()):v.warn("calling timeEvent failed due to invalid eventName: "+e):this._queue.push(["timeEvent",[e,t]]))}},{key:"getDeviceId",value:function(){return D.properties["#device_id"]}},{key:"enableTracking",value:function(e){this.enabled=e,this.store._set("ta_enabled",e)}},{key:"optOutTracking",value:function(){this.store.setSuperProperties({},!0),this.store.setDistinctId(r.UUID()),this.store.setAccountId(null),this._queue.splice(0,this._queue.length),this.isOptOut=!0,this.store._set("ta_isOptOut",!0)}},{key:"optOutTrackingAndDeleteUser",value:function(){var e=new Date;this._sendRequest({type:"user_del"},e),this.optOutTracking()}},{key:"optInTracking",value:function(){this.isOptOut=!1,this.store._set("ta_isOptOut",!1)}},{key:"setTrackStatus",value:function(e){switch(e){case"PAUSE":this.eventSaveOnly=!1,this.optInTracking(),this.enableTracking(!1);break;case"STOP":this.eventSaveOnly=!1,this.optOutTracking(!0);break;case"SAVE_ONLY":case"NORMAL":default:this.eventSaveOnly=!1,this.optInTracking(),this.enableTracking(!0)}}}]),e}(),j={name:"thinkingdata",enableLog:!0,enableNative:!1},E=function(){function e(i){t(this,e),i.appId=i.appId?r.checkAppId(i.appId):r.checkAppId(i.appid),i.serverUrl=i.serverUrl?r.checkUrl(i.serverUrl):r.checkUrl(i.server_url);var n=r.extend({},j);r.isObject(i)?this.config=r.extend(n,i):this.config=n,this._init(this.config)}return n(e,[{key:"_isNativePlatform",value:function(){return!(r.isUndefined(this.nativeProxy)||!this._isIOS()&&!this._isAndroid()||!this.config.enableNative)}},{key:"_isIOS",value:function(){return"Conch-ios"===conchConfig.getOS()}},{key:"_isAndroid",value:function(){return"Conch-android"===conchConfig.getOS()}},{key:"_init",value:function(e){this.name=e.name,this.appId=e.appId||e.appid;try{this._isIOS()?this.nativeProxy=PlatformClass.createClass("LayaProxyApi"):this._isAndroid()&&(this.nativeProxy=PlatformClass.createClass("demo.LayaProxyApi"))}catch(e){console.log("[laya log] native createClass failed, err = "+e)}finally{this._isNativePlatform()?(this.initInstanceForNative(this.name,e,this.appId),this._readStorage(e)):this.taJs=new ThinkingAnalyticsAPIForJS(e)}}},{key:"_readStorage",value:function(e){var t=this,i=e.persistenceName,n=e.persistenceNameOld;e.isChildInstance&&(i=e.persistenceName+"_"+e.name,n=e.persistenceNameOld+"_"+e.name),this._state=N.getStorage(i)||{},r.isEmptyObject(this._state)&&(this._state=N.getStorage(n)||{}),r.isEmptyObject(this._state)?N.getStorage(i,!0,(function(e){r.isEmptyObject(e)?N.getStorage(n,!0,(function(e){t._state=r.extend2Layers({},e,t._state)})):t._state=r.extend2Layers({},e,t._state),t._state.distinct_id&&t.identifyForNative(t._state.distinct_id),t._state.account_id&&t.loginForNative(t._state.account_id)})):(this._state.distinct_id&&this.identifyForNative(this._state.distinct_id),this._state.account_id&&this.loginForNative(this._state.account_id))}},{key:"initInstance",value:function(e,t){return this._isNativePlatform()?(r.isUndefined(t)?this[e]=new ThinkingAnalyticsAPI(this.config):this[e]=new ThinkingAnalyticsAPI(t),this[e]):(this[e]=this.taJs.initInstance(e,t),this[e])}},{key:"lightInstance",value:function(e){return this[e]}},{key:"init",value:function(){if(this._isNativePlatform()){var e=window,t=this;return e.__autoTrackCallback=function(e){if(r.isFunction(t.config.autoTrack.callback)){var i=t.config.autoTrack.callback(e);return JSON.stringify(i)}return"{}"},void this.startThinkingAnalyticsForNative()}this.taJs.init()}},{key:"track",value:function(e,t,i,n){this._isNativePlatform()?this.trackForNative(e,t,i,this.appId):this.taJs.track(e,t,i,n)}},{key:"trackUpdate",value:function(e){this._isNativePlatform()?this.trackUpdateForNative(e,this.appId):this.taJs.trackUpdate(e)}},{key:"trackOverwrite",value:function(e){this._isNativePlatform()?this.trackOverwriteForNative(e,this.appId):this.taJs.trackOverwrite(e)}},{key:"trackFirstEvent",value:function(e){this._isNativePlatform()?this.trackFirstEventForNative(e,this.appId):this.taJs.trackFirstEvent(e)}},{key:"userSet",value:function(e,t,i){this._isNativePlatform()?this.userSetForNative(e,this.appId):this.taJs.userSet(e,t,i)}},{key:"userSetOnce",value:function(e,t,i){this._isNativePlatform()?this.userSetOnceForNative(e,this.appId):this.taJs.userSetOnce(e,t,i)}},{key:"userUnset",value:function(e,t,i){this._isNativePlatform()?this.userUnsetForNative(e,this.appId):this.taJs.userUnset(e,t,i)}},{key:"userDel",value:function(e,t){this._isNativePlatform()?this.userDelForNative(this.appId):this.taJs.userDel(e,t)}},{key:"userAdd",value:function(e,t,i){this._isNativePlatform()?this.userAddForNative(e,this.appId):this.taJs.userAdd(e,t,i)}},{key:"userAppend",value:function(e,t,i){this._isNativePlatform()?this.userAppendForNative(e,this.appId):this.taJs.userAppend(e,t,i)}},{key:"userUniqAppend",value:function(e,t,i){this._isNativePlatform()?this.userUniqAppendForNative(e,this.appId):this.taJs.userUniqAppend(e,t,i)}},{key:"flush",value:function(){this._isNativePlatform()?this.flushForNative(this.appId):this.taJs.flush()}},{key:"authorizeOpenID",value:function(e){this.identify(e)}},{key:"identify",value:function(e){this._isNativePlatform()?this.identifyForNative(e,this.appId):this.taJs.identify(e)}},{key:"getDistinctId",value:function(e){if(!r.isUndefined(e)){if(this._isNativePlatform())return void this.getDistinctIdForNative(e,this.appId);e(this.taJs.getDistinctId())}return this.taJs.getDistinctId()}},{key:"login",value:function(e){this._isNativePlatform()?this.loginForNative(e,this.appId):this.taJs.login(e)}},{key:"getAccountId",value:function(e){if(!r.isUndefined(e)){if(this._isNativePlatform())return void this.getAccountIdForNative(e,this.appId);e(this.taJs.getAccountId())}return this.taJs.getAccountId()}},{key:"logout",value:function(){this._isNativePlatform()?this.logoutForNative(this.appId):this.taJs.logout()}},{key:"setSuperProperties",value:function(e){this._isNativePlatform()?this.setSuperPropertiesForNative(e,this.appId):this.taJs.setSuperProperties(e)}},{key:"clearSuperProperties",value:function(){this._isNativePlatform()?this.clearSuperPropertiesForNative(this.appId):this.taJs.clearSuperProperties()}},{key:"unsetSuperProperty",value:function(e){this._isNativePlatform()?this.unsetSuperPropertyForNative(e,this.appId):this.taJs.unsetSuperProperty(e)}},{key:"getSuperProperties",value:function(e){if(!r.isUndefined(e)){if(this._isNativePlatform())return void this.getSuperPropertiesForNative(e,this.appId);e(this.taJs.getSuperProperties())}return this.taJs.getSuperProperties()}},{key:"getPresetProperties",value:function(e){if(!r.isUndefined(e)){if(this._isNativePlatform())return void this.getPresetPropertiesForNative(e,this.appId);e(this.taJs.getPresetProperties())}return this.taJs.getPresetProperties()}},{key:"setDynamicSuperProperties",value:function(e){this._isNativePlatform()?"function"==typeof e?this.dynamicProperties=e:v.warn("setDynamicSuperProperties parameter must be a function type"):this.taJs.setDynamicSuperProperties(e)}},{key:"timeEvent",value:function(e,t){return this._isNativePlatform()?this.timeEventForNative(e,this.appId):this.taJs.timeEvent(e,t)}},{key:"getDeviceId",value:function(e){if(!r.isUndefined(e)){if(this._isNativePlatform())return void this.getDeviceIdForNative(e,this.appId);e(this.taJs.getDeviceId())}return this.taJs.getDeviceId()}},{key:"enableTracking",value:function(e){this._isNativePlatform()?this.enableTrackingForNative(e,this.appId):this.taJs.enableTracking(e)}},{key:"optOutTracking",value:function(){this._isNativePlatform()?this.optOutTrackingForNative(this.appId):this.taJs.optOutTracking()}},{key:"optOutTrackingAndDeleteUser",value:function(){this._isNativePlatform()?this.optOutTrackingAndDeleteUserForNative(this.appId):this.taJs.optOutTrackingAndDeleteUser()}},{key:"optInTracking",value:function(){this._isNativePlatform()?this.optInTrackingForNative(this.appId):this.taJs.optInTracking()}},{key:"setTrackStatus",value:function(e){this._isNativePlatform()?this.setTrackStatusForNative(e,this.appId):this.taJs.setTrackStatus(e)}},{key:"trackForNative",value:function(e,t,i,n){var a=r.isDate(i)?r.formatDate(i):"";e=r.isUndefined(e)?"":e,t=r.isUndefined(t)?{}:t,a=r.isUndefined(a)?"":a,n=r.isUndefined(n)?"":n;var s=r.extend(t,this.dynamicProperties?this.dynamicProperties():{});s=r.encodeDates(s),this._isIOS()?this.nativeProxy.call("track:properties:time:appId:",e,JSON.stringify(s),a,n):this._isAndroid()&&this.nativeProxy.call("track",e,JSON.stringify(s),a,n)}},{key:"trackUpdateForNative",value:function(e,t){e=r.isUndefined(e)?{}:e,t=r.isUndefined(t)?"":t,e.properties=r.extend(r.isUndefined(e.properties)?{}:e.properties,this.dynamicProperties?this.dynamicProperties():{}),e.properties=r.encodeDates(e.properties),this._isIOS()?this.nativeProxy.call("trackUpdate:appId:",JSON.stringify(e),t):this._isAndroid()&&this.nativeProxy.call("trackUpdate",JSON.stringify(e),t)}},{key:"trackFirstEventForNative",value:function(e,t){e=r.isUndefined(e)?{}:e,t=r.isUndefined(t)?"":t,e.properties=r.extend(r.isUndefined(e.properties)?{}:e.properties,this.dynamicProperties?this.dynamicProperties():{}),e.properties=r.encodeDates(e.properties),this._isIOS()?this.nativeProxy.call("trackFirstEvent:appId:",JSON.stringify(e),t):this._isAndroid()&&this.nativeProxy.call("trackFirstEvent",JSON.stringify(e),t)}},{key:"trackOverwriteForNative",value:function(e,t){e=r.isUndefined(e)?{}:e,t=r.isUndefined(t)?"":t,e.properties=r.extend(r.isUndefined(e.properties)?{}:e.properties,this.dynamicProperties?this.dynamicProperties():{}),e.properties=r.encodeDates(e.properties),this._isIOS()?this.nativeProxy.call("trackOverwrite:appId:",JSON.stringify(e),t):this._isAndroid()&&this.nativeProxy.call("trackOverwrite",JSON.stringify(e),t)}},{key:"timeEventForNative",value:function(e,t){e=r.isUndefined(e)?"":e,t=r.isUndefined(t)?"":t,this._isIOS()?this.nativeProxy.call("timeEvent:appId:",e,t):this._isAndroid()&&this.nativeProxy.call("timeEvent",e,t)}},{key:"loginForNative",value:function(e,t){e=r.isUndefined(e)?"":e,t=r.isUndefined(t)?"":t,this._isIOS()?this.nativeProxy.call("login:appId:",e,t):this._isAndroid()&&this.nativeProxy.call("login",e,t)}},{key:"logoutForNative",value:function(e){e=r.isUndefined(e)?"":e,this._isIOS()?this.nativeProxy.call("logout:",e):this._isAndroid()&&this.nativeProxy.call("logout",e)}},{key:"setSuperPropertiesForNative",value:function(e,t){e=r.isUndefined(e)?{}:e,t=r.isUndefined(t)?"":t,e=r.encodeDates(e),this._isIOS()?this.nativeProxy.call("setSuperProperties:appId:",JSON.stringify(e),t):this._isAndroid()&&this.nativeProxy.call("setSuperProperties",JSON.stringify(e),t)}},{key:"getSuperPropertiesForNative",value:function(e,t){t=r.isUndefined(t)?"":t,this._isIOS()?this.nativeProxy.callWithBack((function(t){e(JSON.parse(t))}),"getSuperProperties:",t):this._isAndroid()&&this.nativeProxy.callWithBack((function(t){e(JSON.parse(t))}),"getSuperProperties",t)}},{key:"unsetSuperPropertyForNative",value:function(e,t){e=r.isUndefined(e)?"":e,t=r.isUndefined(t)?"":t,this._isIOS()?this.nativeProxy.call("unsetSuperProperty:appId:",e,t):this._isAndroid()&&this.nativeProxy.call("unsetSuperProperty",e,t)}},{key:"clearSuperPropertiesForNative",value:function(e){e=r.isUndefined(e)?"":e,this._isIOS()?this.nativeProxy.call("clearSuperProperties:",e):this._isAndroid()&&this.nativeProxy.call("clearSuperProperties",e)}},{key:"userSetForNative",value:function(e,t){e=r.isUndefined(e)?{}:e,t=r.isUndefined(t)?"":t,e=r.encodeDates(e),this._isIOS()?this.nativeProxy.call("userSet:appId:",JSON.stringify(e),t):this._isAndroid()&&this.nativeProxy.call("userSet",JSON.stringify(e),t)}},{key:"userSetOnceForNative",value:function(e,t){e=r.isUndefined(e)?{}:e,t=r.isUndefined(t)?"":t,e=r.encodeDates(e),this._isIOS()?this.nativeProxy.call("userSetOnce:appId:",JSON.stringify(e),t):this._isAndroid()&&this.nativeProxy.call("userSetOnce",JSON.stringify(e),t)}},{key:"userAppendForNative",value:function(e,t){e=r.isUndefined(e)?{}:e,t=r.isUndefined(t)?"":t,e=r.encodeDates(e),this._isIOS()?this.nativeProxy.call("userAppend:appId:",JSON.stringify(e),t):this._isAndroid()&&this.nativeProxy.call("userAppend",JSON.stringify(e),t)}},{key:"userUniqAppendForNative",value:function(e,t){e=r.isUndefined(e)?{}:e,t=r.isUndefined(t)?"":t,e=r.encodeDates(e),this._isIOS()?this.nativeProxy.call("userUniqAppend:appId:",JSON.stringify(e),t):this._isAndroid()&&this.nativeProxy.call("userUniqAppend",JSON.stringify(e),t)}},{key:"userAddForNative",value:function(e,t){e=r.isUndefined(e)?{}:e,t=r.isUndefined(t)?"":t,e=r.encodeDates(e),this._isIOS()?this.nativeProxy.call("userAdd:appId:",JSON.stringify(e),t):this._isAndroid()&&this.nativeProxy.call("userAdd",JSON.stringify(e),t)}},{key:"userUnsetForNative",value:function(e,t){e=r.isUndefined(e)?"":e,t=r.isUndefined(t)?"":t,this._isIOS()?this.nativeProxy.call("userUnset:appId:",e,t):this._isAndroid()&&this.nativeProxy.call("userUnset",e,t)}},{key:"userDelForNative",value:function(e){e=r.isUndefined(e)?"":e,this._isIOS()?this.nativeProxy.call("userDel:",e):this._isAndroid()&&this.nativeProxy.call("userDel",e)}},{key:"flushForNative",value:function(e){e=r.isUndefined(e)?"":e,this._isIOS()?this.nativeProxy.call("flush:",e):this._isAndroid()&&this.nativeProxy.call("flush",e)}},{key:"authorizeOpenIDForNative",value:function(e,t){this.identifyForNative(e,t)}},{key:"identifyForNative",value:function(e,t){e=r.isUndefined(e)?"":e,t=r.isUndefined(t)?"":t,this._isIOS()?this.nativeProxy.call("identify:appId:",e,t):this._isAndroid()&&this.nativeProxy.call("identify",e,t)}},{key:"initInstanceForNative",value:function(e,t,i){e=r.isUndefined(e)?"":e,t=r.isUndefined(t)?{}:t,i=r.isUndefined(i)?"":i,this._isIOS()?(this.nativeProxy.call("setCustomerLibInfoWithLibName:libVersion:",s,a),r.isUndefined(t)?this.nativeProxy.call("initInstance:appId:",e,i):this.nativeProxy.call("initInstance:config:",e,JSON.stringify(t))):this._isAndroid()&&(this.nativeProxy.call("setCustomerLibInfo",s,a),r.isUndefined(t)?this.nativeProxy.call("initInstanceAppId",e,i):this.nativeProxy.call("initInstanceConfig",e,JSON.stringify(t)))}},{key:"lightInstanceForNative",value:function(e,t,i){e=r.isUndefined(e)?"":e,t=r.isUndefined(t)?"":t,this._isIOS()?this.nativeProxy.callWithBack((function(e){i(e)}),"lightInstance:appId:",e,t):this._isAndroid()&&this.nativeProxy.callWithBack((function(e){i(e)}),"lightInstance",e,t)}},{key:"startThinkingAnalyticsForNative",value:function(e){e=r.isUndefined(e)?"":e,this._isIOS()?this.nativeProxy.call("startThinkingAnalytics:",e):this._isAndroid()&&this.nativeProxy.call("startThinkingAnalytics",e)}},{key:"getDeviceIdForNative",value:function(e,t){t=r.isUndefined(t)?"":t,this._isIOS()?this.nativeProxy.callWithBack((function(t){e(t)}),"getDeviceId:",t):this._isAndroid()&&this.nativeProxy.callWithBack((function(t){e(t)}),"getDeviceId",t)}},{key:"getDistinctIdForNative",value:function(e,t){t=r.isUndefined(t)?"":t,this._isIOS()?this.nativeProxy.callWithBack((function(t){e(t)}),"getDistinctId:",t):this._isAndroid()&&this.nativeProxy.callWithBack((function(t){e(t)}),"getDistinctId",t)}},{key:"getAccountIdForNative",value:function(e,t){t=r.isUndefined(t)?"":t,this._isIOS()?this.nativeProxy.callWithBack((function(t){e(t)}),"getAccountId:",t):this._isAndroid()&&this.nativeProxy.callWithBack((function(t){e(t)}),"getAccountId",t)}},{key:"getPresetPropertiesForNative",value:function(e,t){function i(t){var i=JSON.parse(t),n={},a=i["#os"];n.os=r.isUndefined(a)?"":a;var s=i["#screen_width"];n.screenWidth=r.isUndefined(s)?0:s;var o=i["#screen_height"];n.screenHeight=r.isUndefined(o)?0:o;var c=i["#network_type"];n.networkType=r.isUndefined(c)?"":c;var u=i["#device_model"];n.deviceModel=r.isUndefined(u)?"":u;var h=i["#os_version"];n.osVersion=r.isUndefined(h)?"":h;var l=i["#device_id"];n.deviceId=r.isUndefined(l)?"":l;var d=i["#zone_offset"];n.zoneOffset=r.isUndefined(d)?"":d;var p=i["#manufacturer"];n.manufacturer=r.isUndefined(p)?"":p,n.toEventPresetProperties=function(){return{"#device_model":n.deviceModel,"#device_id":n.deviceId,"#screen_width":n.screenWidth,"#screen_height":n.screenHeight,"#os":n.os,"#os_version":n.osVersion,"#network_type":n.networkType,"#zone_offset":n.zoneOffset,"#manufacturer":n.manufacturer}},e(n)}t=r.isUndefined(t)?"":t,this._isIOS()?this.nativeProxy.callWithBack(i,"getPresetProperties:",t):this._isAndroid()&&this.nativeProxy.callWithBack(i,"getPresetProperties",t)}},{key:"enableTrackingForNative",value:function(e,t){e=!r.isUndefined(e)&&e,t=r.isUndefined(t)?"":t,this._isIOS()?this.nativeProxy.call("enableTracking:appId:",e.toString(),t):this._isAndroid()&&this.nativeProxy.call("enableTracking",e.toString(),t)}},{key:"optOutTrackingForNative",value:function(e){e=r.isUndefined(e)?"":e,this._isIOS()?this.nativeProxy.call("optOutTracking:",e):this._isAndroid()&&this.nativeProxy.call("optOutTracking",e)}},{key:"optOutTrackingAndDeleteUserForNative",value:function(e){e=r.isUndefined(e)?"":e,this._isIOS()?this.nativeProxy.call("optOutTrackingAndDeleteUser:",e):this._isAndroid()&&this.nativeProxy.call("optOutTrackingAndDeleteUser",e)}},{key:"optInTrackingForNative",value:function(e){e=r.isUndefined(e)?"":e,this._isIOS()?this.nativeProxy.call("optInTracking:",e):this._isAndroid()&&this.nativeProxy.call("optInTracking",e)}},{key:"setTrackStatusForNative",value:function(e,t){t=r.isUndefined(t)?"":t,this._isIOS()?this.nativeProxy.call("setTrackStatus:appId:",e,t):this._isAndroid()&&this.nativeProxy.call("setTrackStatus",e,t)}}]),e}();window.ThinkingAnalyticsAPI=E,window.ThinkingAnalyticsAPIForJS=J;
